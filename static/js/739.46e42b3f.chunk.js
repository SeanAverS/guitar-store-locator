"use strict";(self.webpackChunkguitar_store_locator=self.webpackChunkguitar_store_locator||[]).push([[739],{739:(e,r,t)=>{t.r(r),t.d(r,{default:()=>k});var o=t(43),a=t(942);t(555);const n=(e,r)=>{const[t,a]=(0,o.useState)(null),[n,s]=(0,o.useState)(null),c=(0,o.useCallback)((()=>{if(!navigator.geolocation)return console.error("Geolocation not supported."),a(r),void s("Geolocation is not supported by your browser. Please try a different browser or enable location services.");navigator.geolocation.getCurrentPosition((r=>{const o={lat:r.coords.latitude,lng:r.coords.longitude};t&&!((e,r)=>{const t=e.lat-r.lat,o=e.lng-r.lng;return t*t+o*o>25e-6})(o,t)||(a(o),e(r),s(null))}),(e=>{switch(console.error("Error getting location",e),a(r),e.code){case e.PERMISSION_DENIED:s("Location access denied. Please enable your location in the browser.");break;case e.POSITION_UNAVAILABLE:s("Your location information is unavailable. Please check device settings.");break;case e.TIMEOUT:s("Timed out while trying to retrieve your location. Please try again.");break;default:s("An unknown error occurred while trying to get your location.")}}))}),[t,e,r]);return(0,o.useEffect)((()=>{c()}),[c]),{currentLocation:t,locationError:n}};const s="localhost"===window.location.hostname?"http://localhost:5000":"https://guitar-store-locator.onrender.com",c=()=>{const[e,r]=(0,o.useState)([]),[t,a]=(0,o.useState)(!1),[n,c]=(0,o.useState)(!1),[l,i]=(0,o.useState)(null),d=(0,o.useCallback)((async function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;const t=`${s}/api/nearbyStores?lat=${e.lat}&lng=${e.lng}&limit=${r}`;try{const e=await fetch(t);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const r=await e.json();if(!Array.isArray(r))return console.error("Data fetched from API is not an array"),[];const o=r.map((e=>({...e,source:"google"}))),a={timestamp:Date.now(),data:o};return localStorage.setItem("nearbyStores",JSON.stringify(a)),o}catch(l){return console.error("Error fetching data from Google API:",l),i(l.message),[]}}),[]),u=(0,o.useCallback)((async function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3;const t=`${s}/api/stores/nearby?lat=${e.lat}&lng=${e.lng}&maxDistance=${r}`;try{const e=await fetch(t);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const r=await e.json();return Array.isArray(r)?r.map((e=>({...e,source:"mongodb"}))):(console.error("Data fetched from MongoDB API is not an array"),[])}catch(l){return console.error("Error fetching data from MongoDB:",l),i(l.message),[]}}),[]),g=(0,o.useCallback)((async e=>{c(!0),i(null);let t=[];const o=localStorage.getItem("nearbyStores");if(o)try{const r=JSON.parse(o);if(!r||!Array.isArray(r.data)||"number"!==typeof r.timestamp)throw new Error("Invalid cache format");t=Date.now()-r.timestamp>6e5?await d(e):r.data}catch(l){console.error("Error parsing stored Google data or cache expired:",l),t=await d(e)}else t=await d(e);const n=await u(e),s=new Map;n.forEach((e=>{s.set(e.placeId,e)})),t.forEach((e=>{s.has(e.place_id)||s.set(e.place_id,e)})),r(Array.from(s.values())),a(!0),c(!1)}),[d,u]),m=(0,o.useMemo)((()=>function(e,r){let t;return function(){for(var o=arguments.length,a=new Array(o),n=0;n<o;n++)a[n]=arguments[n];clearTimeout(t),t=setTimeout((()=>e(...a)),r)}}(g,1e3)),[g]);return{stores:e,storesFetched:t,fetchNearbyStores:g,debouncedFetchNearbyStores:m,loading:n,error:l}};var l=t(391),i=t(910),d=t(929),u=t(579);const g=()=>(0,u.jsx)(i.g,{icon:d.YQ4,size:"3x",style:{color:"#007bff",cursor:"pointer"}}),m=()=>(0,u.jsx)(i.g,{icon:d.w5N,size:"3x",style:{color:"black",cursor:"default"}}),h=e=>{let{count:r,position:t}=e;const o=document.createElement("div");return o.style.background="#007bff",o.style.color="#fff",o.style.borderRadius="50%",o.style.padding="10px",o.style.width="10px",o.style.height="10px",o.style.display="flex",o.style.alignItems="center",o.style.justifyContent="center",o.textContent=r,new window.google.maps.marker.AdvancedMarkerElement({position:t,content:o})},f=(e,r)=>({loadMarkers:(0,o.useCallback)((async(o,a)=>{var n;if(null===(n=window.google)||void 0===n||!n.maps||!e.current)return void console.error("Google Maps API is not available.");if(e.current.clusterer&&e.current.clusterer.clearMarkers(),e.current.markers&&e.current.markers.forEach((e=>e.setMap(null))),e.current.markers=[],!o||0===o.length)return;const{AdvancedMarkerElement:s}=await window.google.maps.importLibrary("marker"),c=o.map((e=>{const t=document.createElement("div");(0,l.createRoot)(t).render((0,u.jsx)(g,{}));const o="google"===e.source?e.geometry.location:{lat:e.location.coordinates[1],lng:e.location.coordinates[0]},a=new s({position:o,title:e.name,content:t});return a.addListener("gmp-click",(()=>r(e))),a})),i=await t.e(237).then(t.bind(t,237)).then((e=>e.MarkerClusterer));e.current.clusterer=new i({markers:c,map:e.current,renderer:{render:h}});const d=document.createElement("div");(0,l.createRoot)(d).render((0,u.jsx)(m,{}));const f=new s({map:e.current,position:a,content:d});e.current.markers.push(...c,f)}),[e,r])}),p=(0,o.lazy)((()=>t.e(825).then(t.bind(t,825)))),y=(0,o.lazy)((()=>t.e(794).then(t.bind(t,794)))),b={lat:37.7749,lng:-122.4194},w=["places","marker"],k=()=>{const e=(0,o.useMemo)((()=>({googleMapsApiKey:"AIzaSyDtxCcDPzmI6F_MZfj7_RC8g47Lv3Y0WnE\n",libraries:w,mapId:"c783492cd30b71804d914d90\n"})),[]),{isLoaded:r,loadError:t}=(0,a.KD)(e),s=(0,o.useRef)(null),[l,i]=(0,o.useState)(null),{stores:d,storesFetched:g,fetchNearbyStores:m,debouncedFetchNearbyStores:h,loading:k,error:v}=c(),x=(0,o.useCallback)((e=>{const r={lat:e.coords.latitude,lng:e.coords.longitude};g?h(r):m(r)}),[g,h,m]),{currentLocation:E,locationError:j}=n(x,b),{loadMarkers:S}=f(s,i);(0,o.useEffect)((()=>{r&&s.current&&d.length>0&&E&&S(d,E)}),[r,d,E,S]),(0,o.useEffect)((()=>{E&&s.current&&s.current.panTo(E)}),[E]);const I=(0,o.useCallback)((()=>{if(!l||!E)return"#";const e=`${E.lat},${E.lng}`,{lat:r,lng:t}=l.geometry.location;return`https://www.google.com/maps/dir/?api=1&origin=${e}&destination=${r},${t}&destination_place_id=${l.place_id}&destination_name=${encodeURIComponent(l.name)}&travelmode=driving`}),[l,E]);return t?(0,u.jsx)("div",{children:"Error loading map"}):r?(0,u.jsxs)(u.Fragment,{children:[j&&(0,u.jsxs)("div",{className:"error-message",children:[(0,u.jsx)("p",{children:j}),(0,u.jsx)("p",{children:"Displaying stores near San Francisco as a fallback."})]}),v&&(0,u.jsx)("div",{className:"error-message",children:(0,u.jsxs)("p",{children:["Error fetching stores: ",v,". Please try again later."]})}),(0,u.jsx)(o.Suspense,{fallback:(0,u.jsx)("div",{children:"Loading Map..."}),children:(0,u.jsx)(p,{mapRef:s,currentLocation:E,defaultCenter:b,children:l&&(0,u.jsx)(o.Suspense,{fallback:(0,u.jsx)("div",{children:"Loading Info..."}),children:(0,u.jsx)(y,{marker:l,onClose:()=>i(null),directionsUrl:I()})})})}),k&&(0,u.jsx)("div",{className:"loading-message",children:"Finding nearby stores..."}),g&&0===d.length&&!j&&!v&&(0,u.jsx)("div",{className:"no-stores-message",children:"No stores found near your location. Try adjusting your location or checking back later."})]}):(0,u.jsx)("div",{children:"Loading..."})}}}]);
//# sourceMappingURL=739.46e42b3f.chunk.js.map