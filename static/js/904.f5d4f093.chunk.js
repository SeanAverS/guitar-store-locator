"use strict";(self.webpackChunkguitar_store_locator=self.webpackChunkguitar_store_locator||[]).push([[904],{904:(e,r,t)=>{t.r(r),t.d(r,{default:()=>w});var o=t(43),n=t(942);t(555);const a=(e,r)=>{const[t,n]=(0,o.useState)(null),a=(0,o.useCallback)((()=>{if(!navigator.geolocation)return console.error("Geolocation not supported."),void n(r);navigator.geolocation.getCurrentPosition((r=>{const o={lat:r.coords.latitude,lng:r.coords.longitude};t&&!((e,r)=>{const t=e.lat-r.lat,o=e.lng-r.lng;return t*t+o*o>25e-6})(o,t)||(n(o),e(r))}),(e=>{console.error("Error getting location",e),n(r)}))}),[t,e,r]);return(0,o.useEffect)((()=>{a()}),[a]),t};var s=t(536);const l=()=>{const[e,r]=(0,o.useState)([]),[t,n]=(0,o.useState)(!1),a=(0,o.useCallback)((function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;const o=`http://localhost:5000/api/nearbyStores?lat=${e.lat}&lng=${e.lng}&limit=${t}`;fetch(o).then((e=>{if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return e.json()})).then((e=>{Array.isArray(e)||console.error("Data fetched from API is not an array"),r(e),n(!0),localStorage.setItem("nearbyStores",JSON.stringify(e))})).catch((e=>{console.error("Error fetching data from API:",e)}))}),[]),l=(0,o.useCallback)((e=>{const t=localStorage.getItem("nearbyStores");if(t)try{const e=JSON.parse(t);if(!Array.isArray(e))throw new Error("Stored data is not an array");r(e),n(!0)}catch(o){console.error("Error parsing stored data:",o),a(e)}else a(e)}),[a]),c=(0,o.useMemo)((()=>(0,s.debounce)((e=>{l(e)}),1e3)),[l]);return{stores:e,storesFetched:t,fetchNearbyStores:l,debouncedFetchNearbyStores:c}};var c=t(391),i=t(237),d=t(910),u=t(929),g=t(579);const p=()=>(0,g.jsx)(d.g,{icon:u.YQ4,size:"3x",style:{color:"#007bff",cursor:"pointer"}}),m=()=>(0,g.jsx)(d.g,{icon:u.w5N,size:"3x",style:{color:"black",cursor:"default"}}),h=e=>{let{count:r,position:t}=e;const o=document.createElement("div");return o.style.background="#007bff",o.style.color="#fff",o.style.borderRadius="50%",o.style.padding="10px",o.style.width="10px",o.style.height="10px",o.style.display="flex",o.style.alignItems="center",o.style.justifyContent="center",o.textContent=r,new window.google.maps.marker.AdvancedMarkerElement({position:t,content:o})},f=(e,r)=>({loadMarkers:(0,o.useCallback)((async(t,o)=>{var n;if(null===(n=window.google)||void 0===n||!n.maps||!e.current)return void console.error("Google Maps API is not available.");if(e.current.clusterer&&e.current.clusterer.clearMarkers(),e.current.markers&&e.current.markers.forEach((e=>e.setMap(null))),e.current.markers=[],!t||0===t.length)return;const{AdvancedMarkerElement:a}=await window.google.maps.importLibrary("marker"),s=t.map((e=>{const t=document.createElement("div");(0,c.createRoot)(t).render((0,g.jsx)(p,{}));const o=new a({position:e.geometry.location,title:e.name,content:t});return o.addListener("gmp-click",(()=>r(e))),o}));e.current.clusterer=new i.w1({markers:s,map:e.current,renderer:{render:h}});const l=document.createElement("div");(0,c.createRoot)(l).render((0,g.jsx)(m,{}));const d=new a({map:e.current,position:o,content:l});e.current.markers.push(...s,d)}),[e,r])}),y=e=>{var r;let{marker:t,onClose:o,directionsUrl:n}=e;return(0,g.jsxs)("div",{className:"info-window",children:[(0,g.jsx)("button",{className:"close-btn",onClick:o,children:"\xd7"}),(0,g.jsx)("h3",{children:t.name}),(0,g.jsx)("p",{children:t.vicinity||"No address available"}),void 0!==(null===(r=t.opening_hours)||void 0===r?void 0:r.open_now)&&(0,g.jsxs)("p",{children:[(0,g.jsx)("strong",{children:"Store Status:"})," ",t.opening_hours.open_now?"Open":"Closed"]}),(0,g.jsx)("a",{href:n,target:"_blank",rel:"noopener noreferrer",children:"Directions"})]})},b={lat:37.7749,lng:-122.4194},k=(0,o.lazy)((()=>t.e(825).then(t.bind(t,825)))),v=["places","marker"],w=()=>{const e=(0,o.useMemo)((()=>({googleMapsApiKey:"AIzaSyDtxCcDPzmI6F_MZfj7_RC8g47Lv3Y0WnE\n",libraries:v,mapId:"REACT_APP_MAP_ID=c783492cd30b71804d914d90\n"})),[]),{isLoaded:r,loadError:t}=(0,n.KD)(e),s=(0,o.useRef)(null),[c,i]=(0,o.useState)(null),{stores:d,storesFetched:u,fetchNearbyStores:p,debouncedFetchNearbyStores:m}=l(),h=(0,o.useCallback)((e=>{const r={lat:e.coords.latitude,lng:e.coords.longitude};u?m(r):p(r)}),[u,m,p]),w=a(h,b),{loadMarkers:x}=f(s,i);(0,o.useEffect)((()=>{r&&s.current&&d.length>0&&w&&x(d,w)}),[r,d,w,x]),(0,o.useEffect)((()=>{w&&s.current&&s.current.panTo(w)}),[w]);const j=(0,o.useCallback)((()=>{if(!c||!w)return"#";const e=`${w.lat},${w.lng}`,{lat:r,lng:t}=c.geometry.location;return`https://www.google.com/maps/dir/?api=1&origin=${e}&destination=${r},${t}&destination_place_id=${c.place_id}&destination_name=${encodeURIComponent(c.name)}&travelmode=driving`}),[c,w]);return t?(0,g.jsx)("div",{children:"Error loading map"}):r?(0,g.jsx)(o.Suspense,{fallback:(0,g.jsx)("div",{children:"Loading Map..."}),children:(0,g.jsx)(k,{mapRef:s,currentLocation:w,defaultCenter:b,children:c&&(0,g.jsx)(y,{marker:c,onClose:()=>i(null),directionsUrl:j()})})}):(0,g.jsx)("div",{children:"Loading..."})}}}]);
//# sourceMappingURL=904.f5d4f093.chunk.js.map