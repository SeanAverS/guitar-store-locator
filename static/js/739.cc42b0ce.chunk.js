"use strict";(self.webpackChunkguitar_store_locator=self.webpackChunkguitar_store_locator||[]).push([[739],{739:(e,r,t)=>{t.r(r),t.d(r,{default:()=>k});var o=t(43),a=t(942);t(555);const n=(e,r)=>{const[t,a]=(0,o.useState)(null),[n,s]=(0,o.useState)(null),c=(0,o.useCallback)((()=>{if(!navigator.geolocation)return console.error("Geolocation not supported."),a(r),void s("Geolocation is not supported by your browser. Please try a different browser or enable location services.");navigator.geolocation.getCurrentPosition((r=>{const o={lat:r.coords.latitude,lng:r.coords.longitude};t&&!((e,r)=>{const t=e.lat-r.lat,o=e.lng-r.lng;return t*t+o*o>25e-6})(o,t)||(a(o),e(r),s(null))}),(e=>{switch(console.error("Error getting location",e),a(r),e.code){case e.PERMISSION_DENIED:s("Location access denied. Please enable your location in the browser.");break;case e.POSITION_UNAVAILABLE:s("Your location information is unavailable. Please check device settings.");break;case e.TIMEOUT:s("Timed out while trying to retrieve your location. Please try again.");break;default:s("An unknown error occurred while trying to get your location.")}}))}),[t,e,r]);return(0,o.useEffect)((()=>{c()}),[c]),{currentLocation:t,locationError:n}};const s="localhost"===window.location.hostname?"http://localhost:5000":"https://guitar-store-locator.onrender.com",c=()=>{const[e,r]=(0,o.useState)([]),[t,a]=(0,o.useState)(!1),[n,c]=(0,o.useState)(!1),[l,i]=(0,o.useState)(null),u=(0,o.useCallback)((async function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;const t=`${s}/api/nearbyStores?lat=${e.lat}&lng=${e.lng}&limit=${r}`;try{const e=await fetch(t);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const r=await e.json();if(!Array.isArray(r))return console.error("Data fetched from API is not an array"),[];const o=r.map((e=>({...e,source:"google"}))),a={timestamp:Date.now(),data:o};return localStorage.setItem("nearbyStores",JSON.stringify(a)),o}catch(l){return console.error("Error fetching data from Google API:",l),i(l.message),[]}}),[]),d=(0,o.useCallback)((async function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3;const t=`${s}/api/stores/nearby?lat=${e.lat}&lng=${e.lng}&maxDistance=${r}`;try{const e=await fetch(t);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const r=await e.json();return Array.isArray(r)?r.map((e=>({...e,source:"mongodb"}))):(console.error("Data fetched from MongoDB API is not an array"),[])}catch(l){return console.error("Error fetching data from MongoDB:",l),i(l.message),[]}}),[]),g=(0,o.useCallback)((async e=>{c(!0),i(null);let t=[];const o=localStorage.getItem("nearbyStores");if(o)try{const r=JSON.parse(o);if(!r||!Array.isArray(r.data)||"number"!==typeof r.timestamp)throw new Error("Invalid cache format");t=Date.now()-r.timestamp>6e5?await u(e):r.data}catch(l){console.error("Error parsing stored Google data or cache expired:",l),t=await u(e)}else t=await u(e);const n=await d(e),s=new Map;n.forEach((e=>{s.set(e.placeId,e)})),t.forEach((e=>{s.has(e.place_id)||s.set(e.place_id,e)})),r(Array.from(s.values())),a(!0),c(!1)}),[u,d]),m=(0,o.useMemo)((()=>function(e,r){let t;return function(){for(var o=arguments.length,a=new Array(o),n=0;n<o;n++)a[n]=arguments[n];clearTimeout(t),t=setTimeout((()=>e(...a)),r)}}(g,1e3)),[g]);return{stores:e,storesFetched:t,fetchNearbyStores:g,debouncedFetchNearbyStores:m,loading:n,error:l}};var l=t(391),i=t(910),u=t(929),d=t(579);const g=()=>(0,d.jsx)(i.g,{icon:u.YQ4,size:"3x",style:{color:"#007bff",cursor:"pointer"}}),m=()=>(0,d.jsx)(i.g,{icon:u.w5N,size:"3x",style:{color:"black",cursor:"default"}}),f=e=>{let{count:r,position:t}=e;const o=document.createElement("div");return o.style.background="#007bff",o.style.color="#fff",o.style.borderRadius="50%",o.style.padding="10px",o.style.width="10px",o.style.height="10px",o.style.display="flex",o.style.alignItems="center",o.style.justifyContent="center",o.textContent=r,new window.google.maps.marker.AdvancedMarkerElement({position:t,content:o})},h=(e,r)=>({loadMarkers:(0,o.useCallback)((async(a,n)=>{var s;if(null===(s=window.google)||void 0===s||!s.maps||!e.current)return void console.error("Google Maps API is not available.");if(e.current.clusterer&&e.current.clusterer.clearMarkers(),e.current.markers&&e.current.markers.forEach((e=>e.setMap(null))),e.current.markers=[],!a||0===a.length)return;const{AdvancedMarkerElement:c}=await window.google.maps.importLibrary("marker"),i=a.map((e=>{const t=document.createElement("div");(0,l.createRoot)(t).render((0,d.jsx)(g,{}));const a="google"===e.source?e.geometry.location:{lat:e.location.coordinates[1],lng:e.location.coordinates[0]},n=new c({position:a,title:e.name,content:t});return n.addListener("gmp-click",(()=>{(0,o.startTransition)((()=>{r(e)}))})),n})),u=await t.e(237).then(t.bind(t,237)).then((e=>e.MarkerClusterer));e.current.clusterer=new u({markers:i,map:e.current,renderer:{render:f}});const h=document.createElement("div");(0,l.createRoot)(h).render((0,d.jsx)(m,{}));const p=new c({map:e.current,position:n,content:h});e.current.markers.push(...i,p)}),[e,r])}),p=(0,o.lazy)((()=>t.e(825).then(t.bind(t,825)))),y=(0,o.lazy)((()=>t.e(794).then(t.bind(t,794)))),b={lat:37.7749,lng:-122.4194},w=["places","marker"],k=()=>{const e=(0,o.useMemo)((()=>({googleMapsApiKey:"AIzaSyDtxCcDPzmI6F_MZfj7_RC8g47Lv3Y0WnE\n",libraries:w,mapId:"c783492cd30b71804d914d90\n"})),[]),{isLoaded:r,loadError:t}=(0,a.KD)(e),s=(0,o.useRef)(null),[l,i]=(0,o.useState)(null),{stores:u,storesFetched:g,fetchNearbyStores:m,debouncedFetchNearbyStores:f,error:k}=c(),v=(0,o.useCallback)((e=>{const r={lat:e.coords.latitude,lng:e.coords.longitude};f(r)}),[f]),{currentLocation:E,locationError:x}=n(v,b);(0,o.useEffect)((()=>{r&&E&&!g&&!k&&m(E)}),[r,E,g,m,k]);const{loadMarkers:S}=h(s,i);(0,o.useEffect)((()=>{r&&s.current&&u.length>0&&E&&S(u,E)}),[r,u,E,S]),(0,o.useEffect)((()=>{E&&s.current&&s.current.panTo(E)}),[E]);const A=(0,o.useCallback)((()=>{if(!l||!E)return"#";const e=`${E.lat},${E.lng}`,{lat:r,lng:t}=l.geometry.location;return`https://www.google.com/maps/dir/?api=1&origin=${e}&destination=${r},${t}&destination_place_id=${l.place_id}&destination_name=${encodeURIComponent(l.name)}&travelmode=driving`}),[l,E]);return t?null:r?(0,d.jsxs)(d.Fragment,{children:[g&&0===u.length&&!x&&!k&&(0,d.jsx)("div",{className:"no-stores-found-message",children:"No stores found near your location. Try adjusting your location or checking back later."}),x&&(0,d.jsxs)("div",{className:"sf-fallback-error-message",children:[(0,d.jsx)("p",{children:x}),(0,d.jsx)("p",{children:"Displaying stores near San Francisco as a fallback."})]}),k&&(0,d.jsx)("div",{className:"stores-fetched-error-message",children:(0,d.jsxs)("p",{children:["Error fetching stores: ",k,". Please try again later."]})}),(0,d.jsx)(p,{mapRef:s,currentLocation:E,defaultCenter:b,children:l&&(0,d.jsx)(y,{marker:l,onClose:()=>i(null),directionsUrl:A()})})]}):null}}}]);
//# sourceMappingURL=739.cc42b0ce.chunk.js.map