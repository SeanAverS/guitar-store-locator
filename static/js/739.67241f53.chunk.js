"use strict";(self.webpackChunkguitar_store_locator=self.webpackChunkguitar_store_locator||[]).push([[739],{739:(e,t,r)=>{r.r(t),r.d(t,{default:()=>k});var o=r(43),n=r(942);r(555);const a=(e,t)=>{const[r,n]=(0,o.useState)(null),a=(0,o.useCallback)((()=>{if(!navigator.geolocation)return console.error("Geolocation not supported."),void n(t);navigator.geolocation.getCurrentPosition((t=>{const o={lat:t.coords.latitude,lng:t.coords.longitude};r&&!((e,t)=>{const r=e.lat-t.lat,o=e.lng-t.lng;return r*r+o*o>25e-6})(o,r)||(n(o),e(t))}),(e=>{console.error("Error getting location",e),n(t)}))}),[r,e,t]);return(0,o.useEffect)((()=>{a()}),[a]),r};const s=()=>{const[e,t]=(0,o.useState)([]),[r,n]=(0,o.useState)(!1),a=(0,o.useCallback)((function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;const o=`http://localhost:5000/api/nearbyStores?lat=${e.lat}&lng=${e.lng}&limit=${r}`;fetch(o).then((e=>{if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return e.json()})).then((e=>{Array.isArray(e)||console.error("Data fetched from API is not an array"),t(e),n(!0);const r={timestamp:Date.now(),data:e};localStorage.setItem("nearbyStores",JSON.stringify(r))})).catch((e=>{console.error("Error fetching data from API:",e)}))}),[]),s=(0,o.useCallback)((e=>{const r=localStorage.getItem("nearbyStores");if(r)try{const o=JSON.parse(r);if(!o||!Array.isArray(o.data)||"number"!==typeof o.timestamp)throw new Error("Invalid cache format");if(Date.now()-o.timestamp>6e5)return void a(e);t(o.data),n(!0)}catch(o){console.error("Error parsing stored data or cache expired:",o),a(e)}else a(e)}),[a]),l=(0,o.useMemo)((()=>function(e,t){let r;return function(){for(var o=arguments.length,n=new Array(o),a=0;a<o;a++)n[a]=arguments[a];clearTimeout(r),r=setTimeout((()=>e(...n)),t)}}(s,1e3)),[s]);return{stores:e,storesFetched:r,fetchNearbyStores:s,debouncedFetchNearbyStores:l}};var l=r(391),c=r(910),i=r(929),d=r(579);const u=()=>(0,d.jsx)(c.g,{icon:i.YQ4,size:"3x",style:{color:"#007bff",cursor:"pointer"}}),g=()=>(0,d.jsx)(c.g,{icon:i.w5N,size:"3x",style:{color:"black",cursor:"default"}}),m=e=>{let{count:t,position:r}=e;const o=document.createElement("div");return o.style.background="#007bff",o.style.color="#fff",o.style.borderRadius="50%",o.style.padding="10px",o.style.width="10px",o.style.height="10px",o.style.display="flex",o.style.alignItems="center",o.style.justifyContent="center",o.textContent=t,new window.google.maps.marker.AdvancedMarkerElement({position:r,content:o})},p=(e,t)=>({loadMarkers:(0,o.useCallback)((async(o,n)=>{var a;if(null===(a=window.google)||void 0===a||!a.maps||!e.current)return void console.error("Google Maps API is not available.");if(e.current.clusterer&&e.current.clusterer.clearMarkers(),e.current.markers&&e.current.markers.forEach((e=>e.setMap(null))),e.current.markers=[],!o||0===o.length)return;const{AdvancedMarkerElement:s}=await window.google.maps.importLibrary("marker"),c=o.map((e=>{const r=document.createElement("div");(0,l.createRoot)(r).render((0,d.jsx)(u,{}));const o=new s({position:e.geometry.location,title:e.name,content:r});return o.addListener("gmp-click",(()=>t(e))),o})),i=await r.e(237).then(r.bind(r,237)).then((e=>e.MarkerClusterer));e.current.clusterer=new i({markers:c,map:e.current,renderer:{render:m}});const p=document.createElement("div");(0,l.createRoot)(p).render((0,d.jsx)(g,{}));const f=new s({map:e.current,position:n,content:p});e.current.markers.push(...c,f)}),[e,t])}),f=(0,o.lazy)((()=>r.e(825).then(r.bind(r,825)))),h=(0,o.lazy)((()=>r.e(794).then(r.bind(r,794)))),y={lat:37.7749,lng:-122.4194},b=["places","marker"],k=()=>{const e=(0,o.useMemo)((()=>({googleMapsApiKey:"AIzaSyDtxCcDPzmI6F_MZfj7_RC8g47Lv3Y0WnE\n",libraries:b,mapId:"REACT_APP_MAP_ID=c783492cd30b71804d914d90\n"})),[]),{isLoaded:t,loadError:r}=(0,n.KD)(e),l=(0,o.useRef)(null),[c,i]=(0,o.useState)(null),{stores:u,storesFetched:g,fetchNearbyStores:m,debouncedFetchNearbyStores:k}=s(),w=(0,o.useCallback)((e=>{const t={lat:e.coords.latitude,lng:e.coords.longitude};g?k(t):m(t)}),[g,k,m]),v=a(w,y),{loadMarkers:x}=p(l,i);(0,o.useEffect)((()=>{t&&l.current&&u.length>0&&v&&x(u,v)}),[t,u,v,x]),(0,o.useEffect)((()=>{v&&l.current&&l.current.panTo(v)}),[v]);const C=(0,o.useCallback)((()=>{if(!c||!v)return"#";const e=`${v.lat},${v.lng}`,{lat:t,lng:r}=c.geometry.location;return`https://www.google.com/maps/dir/?api=1&origin=${e}&destination=${t},${r}&destination_place_id=${c.place_id}&destination_name=${encodeURIComponent(c.name)}&travelmode=driving`}),[c,v]);return r?(0,d.jsx)("div",{children:"Error loading map"}):t?(0,d.jsx)(o.Suspense,{fallback:(0,d.jsx)("div",{children:"Loading Map..."}),children:(0,d.jsx)(f,{mapRef:l,currentLocation:v,defaultCenter:y,children:c&&(0,d.jsx)(o.Suspense,{fallback:(0,d.jsx)("div",{children:"Loading Info..."}),children:(0,d.jsx)(h,{marker:c,onClose:()=>i(null),directionsUrl:C()})})})}):(0,d.jsx)("div",{children:"Loading..."})}}}]);
//# sourceMappingURL=739.67241f53.chunk.js.map