"use strict";(self.webpackChunkguitar_store_locator=self.webpackChunkguitar_store_locator||[]).push([[739],{739:(e,r,t)=>{t.r(r),t.d(r,{default:()=>k});var n=t(43),o=t(942);t(555);const a=(e,r)=>{const[t,o]=(0,n.useState)(null),a=(0,n.useCallback)((()=>{if(!navigator.geolocation)return console.error("Geolocation not supported."),void o(r);navigator.geolocation.getCurrentPosition((r=>{const n={lat:r.coords.latitude,lng:r.coords.longitude};t&&!((e,r)=>{const t=e.lat-r.lat,n=e.lng-r.lng;return t*t+n*n>25e-6})(n,t)||(o(n),e(r))}),(e=>{console.error("Error getting location",e),o(r)}))}),[t,e,r]);return(0,n.useEffect)((()=>{a()}),[a]),t};const s=()=>{const[e,r]=(0,n.useState)([]),[t,o]=(0,n.useState)(!1),a=(0,n.useCallback)((function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;const n=`http://localhost:5000/api/nearbyStores?lat=${e.lat}&lng=${e.lng}&limit=${t}`;fetch(n).then((e=>{if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return e.json()})).then((e=>{Array.isArray(e)||console.error("Data fetched from API is not an array"),r(e),o(!0),localStorage.setItem("nearbyStores",JSON.stringify(e))})).catch((e=>{console.error("Error fetching data from API:",e)}))}),[]),s=(0,n.useCallback)((e=>{const t=localStorage.getItem("nearbyStores");if(t)try{const e=JSON.parse(t);if(!Array.isArray(e))throw new Error("Stored data is not an array");r(e),o(!0)}catch(n){console.error("Error parsing stored data:",n),a(e)}else a(e)}),[a]),l=(0,n.useMemo)((()=>function(e,r){let t;return function(){for(var n=arguments.length,o=new Array(n),a=0;a<n;a++)o[a]=arguments[a];clearTimeout(t),t=setTimeout((()=>e(...o)),r)}}(s,1e3)),[s]);return{stores:e,storesFetched:t,fetchNearbyStores:s,debouncedFetchNearbyStores:l}};var l=t(391),c=t(910),i=t(929),d=t(579);const u=()=>(0,d.jsx)(c.g,{icon:i.YQ4,size:"3x",style:{color:"#007bff",cursor:"pointer"}}),g=()=>(0,d.jsx)(c.g,{icon:i.w5N,size:"3x",style:{color:"black",cursor:"default"}}),m=e=>{let{count:r,position:t}=e;const n=document.createElement("div");return n.style.background="#007bff",n.style.color="#fff",n.style.borderRadius="50%",n.style.padding="10px",n.style.width="10px",n.style.height="10px",n.style.display="flex",n.style.alignItems="center",n.style.justifyContent="center",n.textContent=r,new window.google.maps.marker.AdvancedMarkerElement({position:t,content:n})},f=(e,r)=>({loadMarkers:(0,n.useCallback)((async(n,o)=>{var a;if(null===(a=window.google)||void 0===a||!a.maps||!e.current)return void console.error("Google Maps API is not available.");if(e.current.clusterer&&e.current.clusterer.clearMarkers(),e.current.markers&&e.current.markers.forEach((e=>e.setMap(null))),e.current.markers=[],!n||0===n.length)return;const{AdvancedMarkerElement:s}=await window.google.maps.importLibrary("marker"),c=n.map((e=>{const t=document.createElement("div");(0,l.createRoot)(t).render((0,d.jsx)(u,{}));const n=new s({position:e.geometry.location,title:e.name,content:t});return n.addListener("gmp-click",(()=>r(e))),n})),i=await t.e(237).then(t.bind(t,237)).then((e=>e.MarkerClusterer));e.current.clusterer=new i({markers:c,map:e.current,renderer:{render:m}});const f=document.createElement("div");(0,l.createRoot)(f).render((0,d.jsx)(g,{}));const p=new s({map:e.current,position:o,content:f});e.current.markers.push(...c,p)}),[e,r])}),p=(0,n.lazy)((()=>t.e(825).then(t.bind(t,825)))),h=(0,n.lazy)((()=>t.e(794).then(t.bind(t,794)))),y={lat:37.7749,lng:-122.4194},b=["places","marker"],k=()=>{const e=(0,n.useMemo)((()=>({googleMapsApiKey:"AIzaSyDtxCcDPzmI6F_MZfj7_RC8g47Lv3Y0WnE\n",libraries:b,mapId:"REACT_APP_MAP_ID=c783492cd30b71804d914d90\n"})),[]),{isLoaded:r,loadError:t}=(0,o.KD)(e),l=(0,n.useRef)(null),[c,i]=(0,n.useState)(null),{stores:u,storesFetched:g,fetchNearbyStores:m,debouncedFetchNearbyStores:k}=s(),w=(0,n.useCallback)((e=>{const r={lat:e.coords.latitude,lng:e.coords.longitude};g?k(r):m(r)}),[g,k,m]),v=a(w,y),{loadMarkers:x}=f(l,i);(0,n.useEffect)((()=>{r&&l.current&&u.length>0&&v&&x(u,v)}),[r,u,v,x]),(0,n.useEffect)((()=>{v&&l.current&&l.current.panTo(v)}),[v]);const S=(0,n.useCallback)((()=>{if(!c||!v)return"#";const e=`${v.lat},${v.lng}`,{lat:r,lng:t}=c.geometry.location;return`https://www.google.com/maps/dir/?api=1&origin=${e}&destination=${r},${t}&destination_place_id=${c.place_id}&destination_name=${encodeURIComponent(c.name)}&travelmode=driving`}),[c,v]);return t?(0,d.jsx)("div",{children:"Error loading map"}):r?(0,d.jsx)(n.Suspense,{fallback:(0,d.jsx)("div",{children:"Loading Map..."}),children:(0,d.jsx)(p,{mapRef:l,currentLocation:v,defaultCenter:y,children:c&&(0,d.jsx)(n.Suspense,{fallback:(0,d.jsx)("div",{children:"Loading Info..."}),children:(0,d.jsx)(h,{marker:c,onClose:()=>i(null),directionsUrl:S()})})})}):(0,d.jsx)("div",{children:"Loading..."})}}}]);
//# sourceMappingURL=739.bd3dfa11.chunk.js.map