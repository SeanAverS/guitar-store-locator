"use strict";(self.webpackChunkguitar_store_locator=self.webpackChunkguitar_store_locator||[]).push([[739],{739:(e,t,r)=>{r.r(t),r.d(t,{default:()=>w});var o=r(43),n=r(942);r(555);const a=(e,t)=>{const[r,n]=(0,o.useState)(null),a=(0,o.useCallback)((()=>{if(!navigator.geolocation)return console.error("Geolocation not supported."),void n(t);navigator.geolocation.getCurrentPosition((t=>{const o={lat:t.coords.latitude,lng:t.coords.longitude};r&&!((e,t)=>{const r=e.lat-t.lat,o=e.lng-t.lng;return r*r+o*o>25e-6})(o,r)||(n(o),e(t))}),(e=>{console.error("Error getting location",e),n(t)}))}),[r,e,t]);return(0,o.useEffect)((()=>{a()}),[a]),r};const s="localhost"===window.location.hostname?"http://localhost:5000":"https://guitar-store-locator.onrender.com",l=()=>{const[e,t]=(0,o.useState)([]),[r,n]=(0,o.useState)(!1),a=(0,o.useCallback)((function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;const o=`${s}/api/nearbyStores?lat=${e.lat}&lng=${e.lng}&limit=${r}`;fetch(o).then((e=>{if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return e.json()})).then((e=>{Array.isArray(e)||console.error("Data fetched from API is not an array"),t(e),n(!0);const r={timestamp:Date.now(),data:e};localStorage.setItem("nearbyStores",JSON.stringify(r))})).catch((e=>{console.error("Error fetching data from API:",e)}))}),[]),l=(0,o.useCallback)((e=>{const r=localStorage.getItem("nearbyStores");if(r)try{const o=JSON.parse(r);if(!o||!Array.isArray(o.data)||"number"!==typeof o.timestamp)throw new Error("Invalid cache format");if(Date.now()-o.timestamp>6e5)return void a(e);t(o.data),n(!0)}catch(o){console.error("Error parsing stored data or cache expired:",o),a(e)}else a(e)}),[a]),c=(0,o.useMemo)((()=>function(e,t){let r;return function(){for(var o=arguments.length,n=new Array(o),a=0;a<o;a++)n[a]=arguments[a];clearTimeout(r),r=setTimeout((()=>e(...n)),t)}}(l,1e3)),[l]);return{stores:e,storesFetched:r,fetchNearbyStores:l,debouncedFetchNearbyStores:c}};var c=r(391),i=r(910),d=r(929),u=r(579);const g=()=>(0,u.jsx)(i.g,{icon:d.YQ4,size:"3x",style:{color:"#007bff",cursor:"pointer"}}),m=()=>(0,u.jsx)(i.g,{icon:d.w5N,size:"3x",style:{color:"black",cursor:"default"}}),p=e=>{let{count:t,position:r}=e;const o=document.createElement("div");return o.style.background="#007bff",o.style.color="#fff",o.style.borderRadius="50%",o.style.padding="10px",o.style.width="10px",o.style.height="10px",o.style.display="flex",o.style.alignItems="center",o.style.justifyContent="center",o.textContent=t,new window.google.maps.marker.AdvancedMarkerElement({position:r,content:o})},f=(e,t)=>({loadMarkers:(0,o.useCallback)((async(o,n)=>{var a;if(null===(a=window.google)||void 0===a||!a.maps||!e.current)return void console.error("Google Maps API is not available.");if(e.current.clusterer&&e.current.clusterer.clearMarkers(),e.current.markers&&e.current.markers.forEach((e=>e.setMap(null))),e.current.markers=[],!o||0===o.length)return;const{AdvancedMarkerElement:s}=await window.google.maps.importLibrary("marker"),l=o.map((e=>{const r=document.createElement("div");(0,c.createRoot)(r).render((0,u.jsx)(g,{}));const o=new s({position:e.geometry.location,title:e.name,content:r});return o.addListener("gmp-click",(()=>t(e))),o})),i=await r.e(237).then(r.bind(r,237)).then((e=>e.MarkerClusterer));e.current.clusterer=new i({markers:l,map:e.current,renderer:{render:p}});const d=document.createElement("div");(0,c.createRoot)(d).render((0,u.jsx)(m,{}));const f=new s({map:e.current,position:n,content:d});e.current.markers.push(...l,f)}),[e,t])}),h=(0,o.lazy)((()=>r.e(825).then(r.bind(r,825)))),y=(0,o.lazy)((()=>r.e(794).then(r.bind(r,794)))),b={lat:37.7749,lng:-122.4194},k=["places","marker"],w=()=>{const e=(0,o.useMemo)((()=>({googleMapsApiKey:"AIzaSyDtxCcDPzmI6F_MZfj7_RC8g47Lv3Y0WnE\n",libraries:k,mapId:"REACT_APP_MAP_ID=c783492cd30b71804d914d90\n"})),[]),{isLoaded:t,loadError:r}=(0,n.KD)(e),s=(0,o.useRef)(null),[c,i]=(0,o.useState)(null),{stores:d,storesFetched:g,fetchNearbyStores:m,debouncedFetchNearbyStores:p}=l(),w=(0,o.useCallback)((e=>{const t={lat:e.coords.latitude,lng:e.coords.longitude};g?p(t):m(t)}),[g,p,m]),v=a(w,b),{loadMarkers:x}=f(s,i);(0,o.useEffect)((()=>{t&&s.current&&d.length>0&&v&&x(d,v)}),[t,d,v,x]),(0,o.useEffect)((()=>{v&&s.current&&s.current.panTo(v)}),[v]);const C=(0,o.useCallback)((()=>{if(!c||!v)return"#";const e=`${v.lat},${v.lng}`,{lat:t,lng:r}=c.geometry.location;return`https://www.google.com/maps/dir/?api=1&origin=${e}&destination=${t},${r}&destination_place_id=${c.place_id}&destination_name=${encodeURIComponent(c.name)}&travelmode=driving`}),[c,v]);return r?(0,u.jsx)("div",{children:"Error loading map"}):t?(0,u.jsx)(o.Suspense,{fallback:(0,u.jsx)("div",{children:"Loading Map..."}),children:(0,u.jsx)(h,{mapRef:s,currentLocation:v,defaultCenter:b,children:c&&(0,u.jsx)(o.Suspense,{fallback:(0,u.jsx)("div",{children:"Loading Info..."}),children:(0,u.jsx)(y,{marker:c,onClose:()=>i(null),directionsUrl:C()})})})}):(0,u.jsx)("div",{children:"Loading..."})}}}]);
//# sourceMappingURL=739.9a4add90.chunk.js.map