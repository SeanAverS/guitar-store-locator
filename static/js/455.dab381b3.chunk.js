"use strict";(self.webpackChunkguitar_store_locator=self.webpackChunkguitar_store_locator||[]).push([[455],{455:(e,t,r)=>{r.r(t),r.d(t,{default:()=>v});var o=r(43),n=r(942);r(555);const a=e=>{const[t,r]=(0,o.useState)(null),[n,a]=(0,o.useState)(null);return(0,o.useEffect)((()=>{if(!navigator.geolocation)return console.error("Geolocation not supported."),void a("Geolocation is not supported by your browser. Please try a different browser or enable location services.");navigator.geolocation.getCurrentPosition((o=>{const n={lat:o.coords.latitude,lng:o.coords.longitude};t&&!((e,t)=>{const r=e.lat-t.lat,o=e.lng-t.lng;return r*r+o*o>25e-6})(n,t)||(r(n),e(o),a(null))}),(e=>{console.error("Error getting location",e),a((e=>{switch(e){case 1:return"Location access denied. Please enable your location in the browser.";case 2:return"Your location information is unavailable. Please check device settings.";case 3:return"Timed out while trying to retrieve your location. Please try again.";default:return"An unknown error occurred while trying to get your location."}})(e.code))}))}),[t,e]),{currentLocation:t,locationError:n}};const s=async e=>{const t=await fetch(e);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const r=await t.json();return Array.isArray(r)?r:(console.error(`Data fetched from ${e} is not an array`),[])},c="localhost"===window.location.hostname?"http://localhost:5000":"https://guitar-store-locator.onrender.com",l=()=>{const[e,t]=(0,o.useState)([]),[r,n]=(0,o.useState)(!1),[a,l]=(0,o.useState)(!1),[i,u]=(0,o.useState)(null),d=(0,o.useCallback)((async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;const r=`${c}/api/nearbyStores?lat=${e.lat}&lng=${e.lng}&limit=${t}`;try{const e=(await s(r)).map((e=>({...e,source:"google"}))),t={timestamp:Date.now(),data:e};return localStorage.setItem("nearbyStores",JSON.stringify(t)),e}catch(i){return console.error("Error fetching data from Google API:",i),u(i.message),[]}}),[]),g=(0,o.useCallback)((async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3;const r=`${c}/api/stores/nearby?lat=${e.lat}&lng=${e.lng}&maxDistance=${t}`;try{return(await s(r)).map((e=>({...e,source:"mongodb"})))}catch(i){return console.error("Error fetching data from MongoDB:",i),u(i.message),[]}}),[]),m=(0,o.useCallback)((async e=>{l(!0),u(null);let r=[];const o=localStorage.getItem("nearbyStores");if(o)try{const t=JSON.parse(o);if(!t||!Array.isArray(t.data)||"number"!==typeof t.timestamp)throw new Error("Invalid cache format");r=Date.now()-t.timestamp>6e5?await d(e):t.data}catch(i){console.error("Error parsing stored Google data or cache expired:",i),r=await d(e)}else r=await d(e);const a=await g(e),s=new Map;a.forEach((e=>{s.set(e.placeId,e)})),r.forEach((e=>{s.has(e.place_id)||s.set(e.place_id,e)})),t(Array.from(s.values())),n(!0),l(!1)}),[d,g]),f=(0,o.useMemo)((()=>function(e,t){let r;return function(){for(var o=arguments.length,n=new Array(o),a=0;a<o;a++)n[a]=arguments[a];clearTimeout(r),r=setTimeout((()=>e(...n)),t)}}(m,1e3)),[m]);return{stores:e,storesFetched:r,fetchNearbyStores:m,debouncedFetchNearbyStores:f,loading:a,error:i}};var i=r(391),u=r(910),d=r(929),g=r(579);const m=()=>(0,g.jsx)(u.g,{icon:d.YQ4,size:"3x",style:{color:"#007bff",cursor:"pointer"}}),f=()=>(0,g.jsx)(u.g,{icon:d.w5N,size:"3x",style:{color:"black",cursor:"default"}}),y=e=>{let{count:t,position:r}=e;const o=document.createElement("div");return o.style.background="#007bff",o.style.color="#fff",o.style.borderRadius="50%",o.style.padding="10px",o.style.width="10px",o.style.height="10px",o.style.display="flex",o.style.alignItems="center",o.style.justifyContent="center",o.textContent=t,new window.google.maps.marker.AdvancedMarkerElement({position:r,content:o})},h=(e,t)=>({loadMarkers:(0,o.useCallback)((async(n,a)=>{var s;if(null===(s=window.google)||void 0===s||!s.maps||!e.current)return void console.error("Google Maps API is not available.");if(e.current.markers&&e.current.markers.forEach((e=>e.setMap(null))),e.current.markers=[],!n||0===n.length)return;const{AdvancedMarkerElement:c}=await window.google.maps.importLibrary("marker"),l=n.map((e=>{const r=document.createElement("div");let n;(0,i.createRoot)(r).render((0,g.jsx)(m,{})),n="google"===e.source?e.geometry.location:{lat:e.location.coordinates[1],lng:e.location.coordinates[0]};const a=new c({position:n,title:e.name,content:r});return a.addListener("gmp-click",(()=>{(0,o.startTransition)((()=>{t(e)}))})),a})),u=await r.e(237).then(r.bind(r,237)).then((e=>e.MarkerClusterer));e.current.clusterer=new u({markers:l,map:e.current,renderer:{render:y}});const d=document.createElement("div");(0,i.createRoot)(d).render((0,g.jsx)(f,{}));const h=new c({map:e.current,position:a,content:d});e.current.markers.push(...l,h)}),[e,t])}),p=e=>{let{storesFetched:t,stores:r,locationError:o,storesError:n}=e;return!t||0!==r.length||o||n?n?(0,g.jsx)("div",{className:"stores-fetched-error-message",children:(0,g.jsxs)("p",{children:["Error fetching stores: ",n,". Please try again later."]})}):null:(0,g.jsx)("div",{className:"no-stores-found-message",children:"No stores found near your location. Try adjusting your location or checking back later."})},w=(0,o.lazy)((()=>r.e(825).then(r.bind(r,825)))),b=(0,o.lazy)((()=>r.e(794).then(r.bind(r,794)))),k=["places","marker"],v=()=>{const e=(0,o.useMemo)((()=>({googleMapsApiKey:"AIzaSyDtxCcDPzmI6F_MZfj7_RC8g47Lv3Y0WnE\n",libraries:k,mapId:"c783492cd30b71804d914d90\n"})),[]),{isLoaded:t,loadError:r}=(0,n.KD)(e),s=(0,o.useRef)(null),[c,i]=(0,o.useState)(null),{stores:u,storesFetched:d,fetchNearbyStores:m,debouncedFetchNearbyStores:f,error:y}=l(),v=(0,o.useCallback)((e=>{const t={lat:e.coords.latitude,lng:e.coords.longitude};f(t)}),[f]),{currentLocation:E,locationError:x}=a(v);(0,o.useEffect)((()=>{t&&E&&!d&&!y&&m(E)}),[t,E,d,m,y]);const{loadMarkers:S}=h(s,i);(0,o.useEffect)((()=>{t&&s.current&&u.length>0&&E&&S(u,E)}),[t,u,E,S]),(0,o.useEffect)((()=>{E&&s.current&&s.current.panTo(E)}),[E]);const $=(0,o.useCallback)((()=>{if(!c||!E)return"#";let e,t;if(c.geometry&&c.geometry.location)e=c.geometry.location.lat,t=c.geometry.location.lng;else{if(!c.location||!c.location.coordinates)return"#";e=c.location.coordinates[1],t=c.location.coordinates[0]}return`https://www.google.com/maps/dir/?api=1&origin=${`${E.lat},${E.lng}`}&destination=${`${e},${t}`}&destination_place_id=${c.place_id}&destination_name=${encodeURIComponent(c.name)}&travelmode=driving`}),[c,E]);return r?null:t?(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(p,{storesFetched:d,stores:u,locationError:x,storesError:y}),(0,g.jsx)(w,{mapRef:s,currentLocation:E,children:c&&(0,g.jsx)(b,{marker:c,directionsUrl:$(),onClose:()=>i(null)})})]}):null}}}]);
//# sourceMappingURL=455.dab381b3.chunk.js.map