"use strict";(self.webpackChunkguitar_store_locator=self.webpackChunkguitar_store_locator||[]).push([[739],{739:(e,t,r)=>{r.r(t),r.d(t,{default:()=>k});var o=r(43),a=r(942);r(555);const n=(e,t)=>{const[r,a]=(0,o.useState)(null),n=(0,o.useCallback)((()=>{if(!navigator.geolocation)return console.error("Geolocation not supported."),void a(t);navigator.geolocation.getCurrentPosition((t=>{const o={lat:t.coords.latitude,lng:t.coords.longitude};r&&!((e,t)=>{const r=e.lat-t.lat,o=e.lng-t.lng;return r*r+o*o>25e-6})(o,r)||(a(o),e(t))}),(e=>{console.error("Error getting location",e),a(t)}))}),[r,e,t]);return(0,o.useEffect)((()=>{n()}),[n]),r};const s="localhost"===window.location.hostname?"http://localhost:5000":"https://guitar-store-locator.onrender.com",c=()=>{const[e,t]=(0,o.useState)([]),[r,a]=(0,o.useState)(!1),[n,c]=(0,o.useState)(!1),[l,i]=(0,o.useState)(null),u=(0,o.useCallback)((async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;const r=`${s}/api/nearbyStores?lat=${e.lat}&lng=${e.lng}&limit=${t}`;try{const e=await fetch(r);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const t=await e.json();if(!Array.isArray(t))return console.error("Data fetched from API is not an array"),[];const o=t.map((e=>({...e,source:"google"}))),a={timestamp:Date.now(),data:o};return localStorage.setItem("nearbyStores",JSON.stringify(a)),o}catch(l){return console.error("Error fetching data from Google API:",l),i(l.message),[]}}),[]),d=(0,o.useCallback)((async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3;const r=`${s}/api/stores/nearby?lat=${e.lat}&lng=${e.lng}&maxDistance=${t}`;try{const e=await fetch(r);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const t=await e.json();return Array.isArray(t)?t.map((e=>({...e,source:"mongodb"}))):(console.error("Data fetched from MongoDB API is not an array"),[])}catch(l){return console.error("Error fetching data from MongoDB:",l),i(l.message),[]}}),[]),g=(0,o.useCallback)((async e=>{c(!0),i(null);let r=[];const o=localStorage.getItem("nearbyStores");if(o)try{const t=JSON.parse(o);if(!t||!Array.isArray(t.data)||"number"!==typeof t.timestamp)throw new Error("Invalid cache format");r=Date.now()-t.timestamp>6e5?await u(e):t.data}catch(l){console.error("Error parsing stored Google data or cache expired:",l),r=await u(e)}else r=await u(e);const n=await d(e),s=new Map;n.forEach((e=>{s.set(e.placeId,e)})),r.forEach((e=>{s.has(e.place_id)||s.set(e.place_id,e)})),t(Array.from(s.values())),a(!0),c(!1)}),[u,d]),m=(0,o.useMemo)((()=>function(e,t){let r;return function(){for(var o=arguments.length,a=new Array(o),n=0;n<o;n++)a[n]=arguments[n];clearTimeout(r),r=setTimeout((()=>e(...a)),t)}}(g,1e3)),[g]);return{stores:e,storesFetched:r,fetchNearbyStores:g,debouncedFetchNearbyStores:m,loading:n,error:l}};var l=r(391),i=r(910),u=r(929),d=r(579);const g=()=>(0,d.jsx)(i.g,{icon:u.YQ4,size:"3x",style:{color:"#007bff",cursor:"pointer"}}),m=()=>(0,d.jsx)(i.g,{icon:u.w5N,size:"3x",style:{color:"black",cursor:"default"}}),f=e=>{let{count:t,position:r}=e;const o=document.createElement("div");return o.style.background="#007bff",o.style.color="#fff",o.style.borderRadius="50%",o.style.padding="10px",o.style.width="10px",o.style.height="10px",o.style.display="flex",o.style.alignItems="center",o.style.justifyContent="center",o.textContent=t,new window.google.maps.marker.AdvancedMarkerElement({position:r,content:o})},p=(e,t)=>({loadMarkers:(0,o.useCallback)((async(o,a)=>{var n;if(null===(n=window.google)||void 0===n||!n.maps||!e.current)return void console.error("Google Maps API is not available.");if(e.current.clusterer&&e.current.clusterer.clearMarkers(),e.current.markers&&e.current.markers.forEach((e=>e.setMap(null))),e.current.markers=[],!o||0===o.length)return;const{AdvancedMarkerElement:s}=await window.google.maps.importLibrary("marker"),c=o.map((e=>{const r=document.createElement("div");(0,l.createRoot)(r).render((0,d.jsx)(g,{}));const o=new s({position:e.geometry.location,title:e.name,content:r});return o.addListener("gmp-click",(()=>t(e))),o})),i=await r.e(237).then(r.bind(r,237)).then((e=>e.MarkerClusterer));e.current.clusterer=new i({markers:c,map:e.current,renderer:{render:f}});const u=document.createElement("div");(0,l.createRoot)(u).render((0,d.jsx)(m,{}));const p=new s({map:e.current,position:a,content:u});e.current.markers.push(...c,p)}),[e,t])}),h=(0,o.lazy)((()=>r.e(825).then(r.bind(r,825)))),y=(0,o.lazy)((()=>r.e(794).then(r.bind(r,794)))),w={lat:37.7749,lng:-122.4194},b=["places","marker"],k=()=>{const e=(0,o.useMemo)((()=>({googleMapsApiKey:"AIzaSyDtxCcDPzmI6F_MZfj7_RC8g47Lv3Y0WnE\n",libraries:b,mapId:"c783492cd30b71804d914d90\n"})),[]),{isLoaded:t,loadError:r}=(0,a.KD)(e),s=(0,o.useRef)(null),[l,i]=(0,o.useState)(null),{stores:u,storesFetched:g,fetchNearbyStores:m,debouncedFetchNearbyStores:f}=c(),k=(0,o.useCallback)((e=>{const t={lat:e.coords.latitude,lng:e.coords.longitude};g?f(t):m(t)}),[g,f,m]),v=n(k,w),{loadMarkers:x}=p(s,i);(0,o.useEffect)((()=>{t&&s.current&&u.length>0&&v&&x(u,v)}),[t,u,v,x]),(0,o.useEffect)((()=>{v&&s.current&&s.current.panTo(v)}),[v]);const E=(0,o.useCallback)((()=>{if(!l||!v)return"#";const e=`${v.lat},${v.lng}`,{lat:t,lng:r}=l.geometry.location;return`https://www.google.com/maps/dir/?api=1&origin=${e}&destination=${t},${r}&destination_place_id=${l.place_id}&destination_name=${encodeURIComponent(l.name)}&travelmode=driving`}),[l,v]);return r?(0,d.jsx)("div",{children:"Error loading map"}):t?(0,d.jsx)(o.Suspense,{fallback:(0,d.jsx)("div",{children:"Loading Map..."}),children:(0,d.jsx)(h,{mapRef:s,currentLocation:v,defaultCenter:w,children:l&&(0,d.jsx)(o.Suspense,{fallback:(0,d.jsx)("div",{children:"Loading Info..."}),children:(0,d.jsx)(y,{marker:l,onClose:()=>i(null),directionsUrl:E()})})})}):(0,d.jsx)("div",{children:"Loading..."})}}}]);
//# sourceMappingURL=739.dd4735a6.chunk.js.map